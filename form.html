<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrasi Pengguna</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <style>
    body {
      background: linear-gradient(135deg, #f8f9fa, #e2e6ea);
    }
    .card {
      border: none;
      border-radius: 16px;
    }
    .form-control:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }
    .btn-google {
      background-color: white;
      color: #757575;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
    }
    .btn-google:hover {
      background-color: #f1f3f4;
      box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }
    .google-icon {
      width: 18px;
      height: 18px;
    }
    .or-divider {
      display: flex;
      align-items: center;
      text-align: center;
      margin: 20px 0;
    }
    .or-divider::before, .or-divider::after {
      content: '';
      flex: 1;
      border-bottom: 1px solid #ddd;
    }
    .or-divider span {
      padding: 0 10px;
      color: #757575;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <div class="container d-flex justify-content-center align-items-center vh-100">
    <div class="col-md-6">
      <div class="card p-4 shadow">
        <h3 class="text-center mb-4 text-primary">üìù Register</h3>
        
        <!-- Daftar dengan Google Button -->
        <button id="googleSignup" class="btn btn-lg btn-google mb-3">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="google-icon" alt="Google logo">
          Daftar dengan Google
        </button>
        
        <div class="or-divider">
          <span>ATAU</span>
        </div>
        
        <!-- Form register normal -->
        <form action="insert.jsp" method="post">
          <div class="mb-3">
            <label for="nama" class="form-label">üë§ Nama Lengkap</label>
            <input type="text" class="form-control" id="nama" name="nama" placeholder="Masukkan nama Anda" required>
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">üìß Email</label>
            <input type="email" class="form-control" id="email" name="email" placeholder="email@example.com" required>
          </div>
          <div class="mb-4">
            <label for="password" class="form-label">üîí Password</label>
            <input type="password" class="form-control" id="password" name="password" placeholder="********" required>
          </div>
          <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg">üíæ Simpan Data</button>
          </div>
        </form>
        <div class="text-center mt-3">
          <small>Sudah punya akun? <a href="login.jsp" class="text-decoration-none">Login di sini</a></small>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Konfigurasi Firebase - GANTI dengan konfigurasi dari Firebase Console Anda
     const firebaseConfig = {
      apiKey: "AIzaSyD9H6zdJh50_lRtmJJHN9AYyrYgF3OlL5M",
      authDomain: "entreprise-b4307.firebaseapp.com",
      projectId: "entreprise-b4307",
      storageBucket: "entreprise-b4307.appspot.com", // PERBAIKAN: format appspot.com yang benar
      messagingSenderId: "585290944703",
      appId: "1:585290944703:web:0cc9e343d1c9139fcab60a",
      measurementId: "G-DG8GMYB4PM"
    };

    // Inisialisasi Firebase
    firebase.initializeApp(firebaseConfig);
    
    // Setup Google signup
    document.getElementById('googleSignup').addEventListener('click', function() {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider)
        .then((result) => {
          // User berhasil login/signup dengan Google
          const user = result.user;
          console.log("Google signup success", user);
          
          // Kirim data ke server untuk diproses
          sendUserDataToServer(user);
        })
        .catch((error) => {
          console.error("Error during Google sign up:", error);
          alert("Pendaftaran gagal: " + error.message);
        });
    });
    
    // Fungsi untuk mengirim data ke server (sama seperti di login.html)
    function sendUserDataToServer(user) {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = 'firebase-auth-process.jsp';
      
      const fields = {
        'firebaseUid': user.uid,
        'displayName': user.displayName,
        'email': user.email,
        'photoURL': user.photoURL
      };
      
      for (const key in fields) {
        if (fields[key]) {
          const hiddenField = document.createElement('input');
          hiddenField.type = 'hidden';
          hiddenField.name = key;
          hiddenField.value = fields[key];
          form.appendChild(hiddenField);
        }
      }
      
      document.body.appendChild(form);
      form.submit();
    }
  </script>
  
  <script src="js/bootstrap.bundle.min.js"></script>
</body>
</html>